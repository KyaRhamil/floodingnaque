# ============================================================================
# WEB FRAMEWORK & API
# ============================================================================
Flask==3.0.3
flask-cors==6.0.0  # Updated: fixes GHSA-43qf-4rqw-9q2g, GHSA-8vgw-p6qm-5gr7, GHSA-7rxf-gvfg-47g4
Werkzeug==3.1.5  # Updated: fixes GHSA-hgf8-39gv-g3f2, GHSA-87hc-h4r5-73f7

# Production Servers
gunicorn==23.0.0  # Linux/macOS/Docker (updated: fixes request smuggling CVE-2024-1135)
waitress==3.0.2  # Windows alternative (updated: fixes DoS CVE-2024-49768, race condition CVE-2024-49769)

# ============================================================================
# HTTP & EXTERNAL APIs
# ============================================================================
requests==2.32.4  # Updated: fixes GHSA-9hjg-9r4m-mvj7
urllib3==2.6.3  # Updated: fixes GHSA-48p4-8xcf-vxj5, GHSA-pq67-6m6q-mj2v, GHSA-gm62-xv2j-4w53, GHSA-2xpw-w6gg-jr37, GHSA-38jv-5279-wg99
aiohttp==3.13.3  # Updated: fixes GHSA-9548-qrrj-x5pj, GHSA-6mq8-rvhq-8wgg, GHSA-69f9-5gxw-wvc2 and more
aiohttp[speedups]==3.13.3  # Optional C extensions for better performance
tenacity==9.1.2  # Retry logic with exponential backoff (>=9.1.2 required by schemathesis)

# ============================================================================
# DATA PROCESSING & MACHINE LEARNING
# ============================================================================
# Core scientific stack - PINNED for ML model reproducibility
# CRITICAL: These versions must match training environment to ensure
# saved models load correctly. Changing versions may break model loading.
# See: app/utils/ml_version_check.py for runtime validation
numpy==2.1.3  # Array serialization in saved models
pandas==2.2.3  # DataFrame structure in preprocessing
scikit-learn==1.8.0  # Model pickle format changes between versions
joblib==1.4.2  # Serialization format for .joblib files
scipy==1.14.1  # Used internally by scikit-learn

# ============================================================================
# SCHEDULING & BACKGROUND TASKS
# ============================================================================
APScheduler==3.10.4
celery==5.4.0  # Distributed task queue for background processing

# ============================================================================
# CONFIGURATION & ENVIRONMENT
# ============================================================================
python-dotenv==1.0.1

# ============================================================================
# DATABASE & ORM
# ============================================================================
SQLAlchemy==2.0.35
alembic==1.13.3
pg8000==1.31.5  # Updated: fixes GHSA-wq2g-r956-j8cc
psycopg2-binary==2.9.10  # Faster C-based driver for Linux/Docker production
                          # Both drivers are installed; code auto-selects based on platform

# ============================================================================
# DATA VISUALIZATION
# ============================================================================
matplotlib==3.9.2
seaborn==0.13.2

# ============================================================================
# SECURITY & AUTHENTICATION
# ============================================================================
cryptography==45.0.3  # Latest security patches, pinned
itsdangerous==2.2.0
bcrypt==4.3.0
PyJWT==2.9.0  # For JWT token-based authentication

# ============================================================================
# INPUT VALIDATION & SANITIZATION
# ============================================================================
validators==0.34.0
bleach==6.2.0
email-validator==2.2.0  # Enhanced email validation

# ============================================================================
# RATE LIMITING & CACHING
# ============================================================================
Flask-Limiter==4.1.1  # Updated: v4.x removes rich dependency, resolves conflicts
Flask-Session==0.8.0  # Server-side session storage (Redis in production)
redis==5.2.0  # For rate limiting, caching, and sessions
limits==3.13.0  # Required by Flask-Limiter
packaging==24.2  # Required by limits, pinned
# rich is no longer required by Flask-Limiter 4.x, but still used by schemathesis

# ============================================================================
# PERFORMANCE OPTIMIZATION
# ============================================================================
flask-compress==1.15
Flask-Caching==2.3.0  # Response caching

# ============================================================================
# API DOCUMENTATION
# ============================================================================
flasgger==0.9.7.1  # Swagger/OpenAPI documentation
PyYAML==6.0.2  # YAML export for OpenAPI schema

# ============================================================================
# MONITORING, LOGGING & ERROR TRACKING
# ============================================================================
python-json-logger==3.2.1
prometheus-flask-exporter==0.23.1  # Prometheus metrics, pinned
sentry-sdk[flask]==2.18.0  # Installed but not yet configured
                           # To enable: Set SENTRY_DSN in .env and initialize in app.py
                           # See: https://docs.sentry.io/platforms/python/guides/flask/
ddtrace==2.14.4 ; platform_system != "Windows"  # Datadog APM tracing
                 # Auto-instrumentation: ddtrace-run python main.py
                 # See: https://docs.datadoghq.com/tracing/trace_collection/dd_libraries/python/

# ============================================================================
# PROGRESS TRACKING
# ============================================================================
tqdm==4.67.1

# ============================================================================
# WEATHER DATA SOURCES
# ============================================================================
meteostat==1.6.8

# ============================================================================
# EXTERNAL DATA SOURCES (Free APIs)
# ============================================================================
# Open-Meteo - Weather forecasts & historical data (no API key needed)
openmeteo-requests==1.2.0
requests-cache==1.2.1  # Caching for Open-Meteo
retry-requests==2.0.0  # Retry logic for API calls

# NASA GPM/IMERG - Satellite rainfall data
# NOTE: These packages require HDF5 libraries on Windows.
# For Windows users, install via conda instead:
#   conda install -c conda-forge netcdf4 h5py xarray
# Or comment out if not using satellite rainfall data.
# netCDF4==1.7.1  # Requires HDF5 headers to build on Windows
# h5py==3.12.1
# xarray==2024.10.0

# PAGASA/Web Scraping
beautifulsoup4==4.12.3
lxml==5.3.0

# NAMRIA Tide Tables (PDF/Excel parsing)
tabula-py==2.9.3
openpyxl==3.1.5

# OpenStreetMap Queries
overpy==0.7

# Model Explainability (Large dependency ~500MB)
shap==0.50.0  # Requires C++ build tools on Windows (Visual Studio Build Tools with Windows SDK)

# Geospatial (for flood mapping features)
geopandas==1.0.1
folium==0.18.0  # Interactive maps
shapely==2.0.6  # Geometric operations

# Time Series Analysis (for temporal pattern analysis)
statsmodels==0.14.4
prophet==1.1.6  # Facebook's forecasting tool
                # Optional: Commented out due to heavy build requirements (cmdstan)
                # Uncomment if needed: pip install prophet==1.1.6

# ============================================================================
# SERVER-SENT EVENTS (SSE)
# ============================================================================
sse-starlette==3.2.0  # SSE support (compatible with Flask via adapters)
flask-sse==1.0.0  # Flask SSE extension for real-time updates

# ============================================================================
# GRAPHQL
# ============================================================================
graphene==3.4.3  # GraphQL schema definition framework
graphql-server==3.0.0b7  # Use graphql-server instead of flask-graphql
#flask-graphql==2.0.1  # GraphQL endpoint integration
graphql-core==3.2.5  # GraphQL core library for schema and execution

# ============================================================================
# GOOGLE CLOUD / EARTH ENGINE
# ============================================================================
# Earth Engine Python API for satellite data
earthengine-api==1.4.3

# Google Cloud BigQuery for historical weather data
google-cloud-bigquery==3.27.0

# Google Authentication
google-auth==2.37.0
google-auth-oauthlib==1.2.1
google-auth-httplib2==0.2.0

# Google Cloud Storage (for caching Earth Engine exports)
google-cloud-storage==2.19.0

# Protocol buffers (required by Google Cloud)
protobuf==5.29.5  # Updated: fixes GHSA-8qvm-5x2c-j2w7
